{
    "version": "1.0.16065",
    "description": "An AI-powered IDE that makes programming more enjoyable and efficient.",
    "homepage": "https://www.trae.com.cn",
    "license": "Proprietary",
    "architecture": {
        "64bit": {
            "url": "https://lf-cdn.trae.com.cn/obj/trae-com-cn/pkg/app/releases/stable/1.0.16065/win32/Trae%20CN-Setup-x64.exe",
            "hash": "815a63461d11a4d8dce3eb3458f250c24266040a896471c867a9ff56b89a4615",
            "extract_dir": "{code_GetDestDir}"
        }
    },
    "innosetup": true,
    "pre_install": [
        "function Create-SymlinkIfNotExists($target_dir, $link_dir) {",
        "    # 检查目标是否已经是符号链接",
        "    if (Test-Path $target_dir) {",
        "        $item = Get-Item $target_dir -Force",
        "        if ($item.Attributes -match 'ReparsePoint') {",
        "            # 如果已经是符号链接，则跳过",
        "            return",
        "        }",
        "    }",
        "",
        "    # 确保$link_dir目录存在",
        "    if (-not (Test-Path $link_dir)) {",
        "        New-Item -ItemType Directory -Path $link_dir -Force | Out-Null",
        "    }",
        "",
        "    if (Test-Path $target_dir) {",
        "        if (-not (Get-ChildItem -Path $target_dir -Force)) {",
        "            # 目标目录存在但为空，直接删除并创建符号链接",
        "            Remove-Item $target_dir -Force",
        "            New-Item -ItemType SymbolicLink -Path $target_dir -Target $link_dir | Out-Null",
        "        } else {",
        "            # 目标目录存在且包含内容，需要移动",
        "            $items = Get-ChildItem -Path $target_dir -Force",
        "            if ($items) {",
        "                foreach ($item in $items) {",
        "                    $dest = Join-Path $link_dir $item.Name",
        "                    if (-not (Test-Path $dest)) {",
        "                        Move-Item -Path $item.FullName -Destination $link_dir -Force",
        "                    }",
        "                }",
        "            }",
        "            Remove-Item $target_dir -Force",
        "            New-Item -ItemType SymbolicLink -Path $target_dir -Target $link_dir | Out-Null",
        "        }",
        "    } else {",
        "        New-Item -ItemType SymbolicLink -Path $target_dir -Target $link_dir | Out-Null",
        "    }",
        "}",
        "",
        "# 处理用户配置目录",
        "$config_dirs = @(",
        "    '.trae',",
        "    '.trae-cn',",
        "    '.trae-aicc'",
        ")",
        "foreach ($config_dir in $config_dirs) {",
        "    $target_dir = Join-Path $env:USERPROFILE $config_dir",
        "    $link_dir = Join-Path $persist_dir $config_dir",
        "    Create-SymlinkIfNotExists $target_dir $link_dir",
        "}",
        "",
        "# 链接 $env:APPDATA\\Trae CN 到 persist_dir/data",
        "$appdata_dir = Join-Path $env:APPDATA \"Trae CN\"",
        "$persist_data_dir = Join-Path $persist_dir data",
        "Create-SymlinkIfNotExists $appdata_dir $persist_data_dir"
    ],
    "bin": [
        [
            "bin/trae.cmd",
            "traecn"
        ]
    ],
    "shortcuts": [
        [
            "Trae CN.exe",
            "Trae CN"
        ]
    ],
    "persist": [
        "data",
        ".trae",
        ".trae-cn",
        ".trae-aicc"
    ],
    "checkver": {
        "url": "https://api.trae.com.cn/icube/api/v1/native/version/trae/cn/latest",
        "jsonpath": "$.data.manifest.win32.version"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://lf-cdn.trae.com.cn/obj/trae-com-cn/pkg/app/releases/stable/$version/win32/Trae%20CN-Setup-x64.exe"
            }
        }
    }
}
